<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link th:href="@{/css/bootstrap.min.css}"
          href="css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script>
        const add_file_box = () => {
            const box = document.getElementById("attachFileDiv");
            const newDiv = document.createElement('div');
            newDiv.innerHTML = "<input type='file' name='addFiles'>\n<button type='button' class='btn btn-outline-dark' onclick='delete_file_box(this)'>X</button>"
            box.appendChild(newDiv);
        }
        const delete_file_box = (obj) => {
            document.getElementById('attachFileDiv').removeChild(obj.parentNode);
        }

        function deleteComment(seq) {
            if (confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                $.ajax({
                    type: 'DELETE',
                    url: '/api/reply/' + seq,
                    success: function (data) {
                        // ì„±ê³µì ìœ¼ë¡œ ì‚­ì œëœ ê²½ìš°, í™”ë©´ì—ì„œ ëŒ“ê¸€ì„ ì œê±°í•©ë‹ˆë‹¤.
                        alert('ëŒ“ê¸€ ì‚­ì œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.');
                        location.reload();
                    },
                    error: function (error) {
                        // ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš°, ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
                        alert('ëŒ“ê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
        }

    </script>
    <style>
        .container-fluid {
            max-width: 1000px;
        }

        /*************** ë² ë„ˆ ë””ìì¸ *************/
        .board-name-container {
            margin: 24px;
        }

        .reply-write-box {
            margin-bottom: 10px;
        }

        .reply-content-box {
            margin: 5px;
        }

        .reply-content {
            margin: 5px;
        }

        /************ ì‘ì„± í¼ ë‚´ë¶€ ë””ìì¸ ***********/
        textarea {
            height: 200px;
        }

        /* ì²¨ë¶€íŒŒì¼ */
        .file-box {
            margin: 5px;
        }

        .delete-btn {
            width: 57px;
            font-size: 15px;
        }

        /* ê²€ì¦ ì—ëŸ¬ í‘œí˜„ */
        .field-error {
            border-color: #dc3545;
            color: #dc3545;

        }

    </style>
</head>
<body>

<div class="container-fluid">

    <div th:replace="~{fragment/header}"></div>

    <div class="row">

        <div class="col-md-3">
            <div th:replace="~{fragment/sidebar}"></div>
        </div>

        <div class="col-md-9">

            <div class="board-name-container">
                <h3>ììœ ê²Œì‹œíŒ ê´€ë¦¬</h3>
            </div>

            <form action th:object="${freeBoardDTO}" th:action method="post" enctype="multipart/form-data">
                <table class="table">
                    <tbody>
                    <tr>
                        <th class="bg-gray">ë¶„ë¥˜</th>
                        <td>
                            <select name="categoryId" th:field="*{categoryId}" th:errorclass="field-error"
                                    class="form-control">
                                <option value="hobby">ì·¨ë¯¸</option>
                                <option value="humor">ìœ ë¨¸</option>
                                <option value="touching">ê°ë™</option>
                            </select>
                            <div class="field-error" th:errors="*{categoryId}"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="bg-gray">ì œëª©</th>
                        <td><input type="text" name="subject" th:field="*{subject}" th:errorclass="field-error"
                                   class="form-control">
                            <div class="field-error" th:errors="*{subject}" th:errorclass="field-error"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="bg-gray">ë‚´ìš©</th>
                        <td><textarea name="content" th:field="*{content}" th:errorclass="field-error"
                                      class="content-form form-control"></textarea>
                            <div class="field-error" th:errors="*{content}"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="bg-gray">ì²¨ë¶€íŒŒì¼</th>
                        <td>
                            <div class="file-container" th:if="${fileList}">
                                <div class="file-box row" th:each="file : ${fileList}">
                                    <span class="col-md-1">ğŸ“</span>
                                    ï¸
                                    <div class="attachment-box col-md-9" th:text="${file.originName}"></div>
                                    <button type="button" class="delete-btn btn btn-outline-dark col-md-1"
                                            th:text="ì‚­ì œ"></button>
                                </div>
                            </div>
                            <div id="attachFileDiv">
                                <input type="file" name="addFiles">
                            </div>
                            <input type="button" value="ì¶”ê°€" onclick="add_file_box()">
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="reply-container" th:if="${replyList}">
                    <div class="reply-write-box row">
                        <input type="text" class="col-md-10" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”">
                        <div class="col-md-2">
                            <button type="button" class="btn btn-light" id="submitComment">ë“±ë¡</button>
                        </div>
                    </div>
                    <div class="reply-content-box row" th:each="reply : ${replyList}">
                        <div class="col-md-10">
                            <div class="reply-label">
                                <span th:if="${reply.memberId}" th:text="${reply.memberId}"></span>
                                <span th:unless="${reply.adminId}" th:text="${reply.adminId}"></span>
                                <span th:text="${#temporals.format(reply.date, 'yyyy-MM-dd HH:mm')}"></span>
                            </div>
                            <div class="reply-content">
                                <span th:text="${reply.content}"></span>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-outline-dark"
                                    th:onclick="|deleteComment(${reply.seq})|">ì‚­ì œ
                            </button>
                        </div>
                    </div>
                </div>

                <input type="submit"
                       class="btn btn-primary pull-right"
                       th:if="${freeBoardDTO.seq == 0}"
                       th:onclick="|location.href='@{/admin/free}'|"
                       value="ë“±ë¡">
                <input type="submit"
                       class="btn btn-primary pull-right"
                       th:unless="${freeBoardDTO.seq == 0}"
                       th:onclick="|location.href='@{/admin/free/{seq}(seq=${freeBoardDTO.seq})}'|"
                       value="ìˆ˜ì •">

                <button
                        type="button"
                        class="btn btn-primary pull-right"
                        th:onclick="|location.href='@{/admin/frees}'|">ëª©ë¡
                </button>
                <button type="button"
                        th:if="${freeBoardDTO.seq != 0}"
                        th:onclick="|location.href='@{/admin/free/delete/{seq}(seq=${freeBoardDTO.seq})}'|"
                        class="btn btn-primary pull-right">ì‚­ì œ
                </button>
            </form>
        </div>
    </div>
</div>

</body>
</html>
